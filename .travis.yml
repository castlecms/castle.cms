language: python
python: 2.7
services:
  - redis-server
before_script:
  - sleep 10
install:
  - mkdir -p {eggs,downloads}
  - wget https://launchpad.net/plone/5.0/5.0.8/+download/Plone-5.0.8-UnifiedInstaller.tgz
  - tar -zxvf Plone-*.tgz > /dev/null
  - tar -xvjf Plone-*/packages/buildout-cache.tar.bz2 > /dev/null
  - cp -rf buildout-cache/eggs/* eggs/
  - cp -rf buildout-cache/downloads/* downloads/
  - pip install -r requirements.txt
  - pip install pyflakes==1.6.0 pycodestyle==2.3.1 flake8==3.5.0
  - buildout -Nc travis.cfg
script:
  - flake8 castle/cms
  - bin/test -s castle.cms -t \!selenium
before_install:
  - curl -O https://download.elastic.co/elasticsearch/release/org/elasticsearch/distribution/deb/elasticsearch/2.4.3/elasticsearch-2.4.3.deb && sudo dpkg -i --force-confnew elasticsearch-2.4.3.deb && sudo service elasticsearch start
  - export BOTO_CONFIG=/dev/null
