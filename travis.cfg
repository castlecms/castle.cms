[buildout]
extends =
    https://dist.plone.org/release/5.2-latest/versions.cfg
    versions.cfg
parts =
    instance
    zopepy
    test
    zeoserver
    zeoserver-replicate

buildout_dir = ${buildout:directory}
var-directory = ${buildout:directory}/var
var-replicate = ${buildout:directory}/var-replicate

index = https://pypi.org/simple
find-links =
    https://nexus.wildcardcorp.com/repository/pypi-public/packages/plone-app-blocks/10.0.28/plone.app.blocks-10.0.28.zip
    https://nexus.wildcardcorp.com/repository/pypi-public/packages/plone-app-mosaic/2.0.0.dev25/plone.app.mosaic-2.0.0.dev25.zip
    https://nexus.wildcardcorp.com/repository/pypi-public/packages/plone-app-registry/1.4.1.dev0/plone.app.registry-1.4.1.dev0.zip
    https://nexus.wildcardcorp.com/repository/pypi-public/packages/plone-app-standardtiles/2.0.0.dev0/plone.app.standardtiles-2.0.0.dev0.zip
    https://nexus.wildcardcorp.com/repository/pypi-public/packages/plonetheme-barceloneta/10.0.0/plonetheme.barceloneta-10.0.0.zip
    https://nexus.wildcardcorp.com/repository/pypi-public/packages/products-zcatalog/3.0.3dev2/Products.ZCatalog-3.0.3dev2.zip
    https://nexus.wildcardcorp.com/repository/pypi-public/packages/z3c-relationfield/0.7.1.dev0/z3c.relationfield-0.7.1.dev0.zip
    https://nexus.wildcardcorp.com/repository/pypi-public/packages/mockup/2.4.2.dev1/mockup-2.4.2.dev1.tar.gz

allow-hosts =
    pypi.org
    files.pythonhosted.org
    *.wildcardcorp.com

package-name = castle.cms
package-extras = [test]

develop = .

eggs =
    castle.cms[test]
    celery[sqlalchemy]
    collective.celery
    argon2_cffi
    Pillow
    Products.PloneKeywordManager
    plone.app.robotframework
    Plone
    wildcard.hps

test-eggs +=
    castle.cms[test]

zcml =
    castle.cms-overrides

eggs +=
    plone.reload 
    Products.ResourceRegistries
    plone.recipe.zeoserver
    service-identity

zcml += 
    Products.ResourceRegistries

versions = versions

[test-environment]
CELERY_TASK_ALWAYS_EAGER = True

[test]
recipe = zc.recipe.testrunner
eggs = ${buildout:eggs}
defaults = ['--auto-color', '-vvv']
environment = test-environment

[instancecommon]
recipe = plone.recipe.zope2instance
environment-vars =
    BROKER_URL sqla+sqlite:///${buildout:directory}/celerydb.sqlite?timeout=30
    CELERY_TASK_ALWAYS_EAGER True
    REDIS_SERVER 127.0.0.1:6379
    LINK_REPORT_DB sqlite:///${buildout:directory}/linkreport.sqlite?timeout=30
user = admin:admin
debug-mode = on
verbose-security = on
deprecation-warnings = off
eggs = ${buildout:eggs}
zcml = ${buildout:zcml}
zodb-cache-size = 50000
zeo-client-cache-size = 250MB
zserver-threads = 2
zeo-client = true
zeo-client-drop-cache-rather-verify = true
event-log-level = WARN
event-log-max-size = 50MB
event-log-old-files = 4
z2-log-level = WARN
access-log-max-size = 50MB
access-log-old-files = 4
shared-blob = on
http-force-connection-close = true
http-fast-listen = off
environment-vars =
    zope_i18n_compile_mo_files true
zope-conf-additional =
    trusted-proxy 127.0.0.1
zcml-additional =

[instance]
<=instancecommon
ip-address = 127.0.0.1
http-address = 8080
zeo-address = 127.0.0.1:8100
zeo-client-client = ${:_buildout_section_name_}
var = ${buildout:var-directory}
file-storage = ${buildout:buildout_dir}/var/filestorage/Data.fs
blob-storage = ${buildout:buildout_dir}/var/blobstorage

[instance-replicate]
<=instancecommon
ip-address = 127.0.0.1
http-address = 8081
zeo-address = 127.0.0.1:8101
zeo-client-client = ${:_buildout_section_name_}
var = ${buildout:var-replicate}

[zeoserver]
recipe = plone.recipe.zeoserver[zrs]
eggs =
    plone.recipe.zeoserver[zrs]
    ${buildout:eggs}
var = ${buildout:var-directory}
zeo-address = 127.0.0.1:8100
replicate-to = localhost:8999

[zeoserver-replicate]
recipe = plone.recipe.zeoserver[zrs]
eggs =
    plone.recipe.zeoserver[zrs]
    ${buildout:eggs}
var = ${buildout:var-replicate}
zeo-address = 127.0.0.1:8101
replicate-from = localhost:8999

[zopepy]
recipe = zc.recipe.egg
eggs =
    ${buildout:eggs}
    ${test:eggs}
    castle.cms
    Plone
    Products.CMFPlone
    plone.staticresources
interpreter = zopepy
scripts =
    zopepy
    plone-compile-resources
